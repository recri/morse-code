<!DOCTYPE html>
<html>
  <head>
    <title>Morse Code Output</title>
  </head>
  <body onload="onLoadHandler()">
    <script type="text/javascript" src="morse.js"></script>
    <script type="text/javascript">
      var station = morse_code_station();
      station.output_decoder.on('letter', function(ltr, code) {
        var elt = document.getElementById("output_text");
        elt.textContent += ltr;
        elt.scrollTop = 1000;
      });
      function slider(id, min, max, value, units, target, ident) {
        // console.log("slider("+id+")");
        var inputid = id+"_input";
        var valueid = id+"_value";
        var identid = id+"_identity";
	document.getElementById(id).innerHTML = '<span id="'+identid+'"></span><input id="'+inputid+'"></input><br/><span id="'+valueid+'"></span>';
        var inp = document.getElementById(inputid);
	var val = document.getElementById(valueid);
        var tag = document.getElementById(identid);
        inp.type = "range";
	inp.min = min;
	inp.max = max;
        if (ident) tag.innerText = ident;
        var target_value = inp.value;
	if (units == "dB") {
          inp.oninput = inp.onchange = function() {
            val.innerHTML = ""+inp.value+" "+units;
	    target(Math.pow(10, inp.value/20))
          }
        } else if (units == "ms") {
          inp.oninput = inp.onchange = function() {
            val.innerHTML = ""+inp.value+" "+units;
	    target(inp.value/1000)
          }
        } else {
          inp.oninput = inp.onchange = function() {
            val.innerHTML = ""+inp.value+" "+units;
	    target(inp.value)
          }
        }
	inp.value = value;
        inp.onchange();
      };
      function morse_code_send_text(id) {
        var elt = document.getElementById(id);
        var text = elt.value;
        elt.value = "";
        station.output.send(text);
      }
      function onLoadHandler() {
	slider("output_pitch", "220", "1760", "600", "Hz", station.output.setPitch, "  Pitch  ");
	slider("output_gain", "-60", "0", "-24", "dB", station.output.setGain, "  Gain  ");
	slider("output_speed", "5", "30", "15", "WPM", station.output.setWPM, "  Speed  ");
        slider("output_rise_time", "1", "10", "4", "ms", station.output.setOnTime, "  Rise  ")
        slider("output_fall_time", "1", "10", "4", "ms", station.output.setOffTime, "  Fall  ")
      };
    </script>
    <style>
      .page {
	margin-left: auto;
	margin-right: auto;
        text-align: center;
	width: 480px;
      }
      .center {
	margin-left: auto;
	margin-right: auto;
	width: 100%;
        text-align: center;
      }
      #output_text {
	height:240px;
	width:75%;
	border:1px solid #ccc;
	font:16px/26px Georgia, Garamond, Serif;
	overflow:auto;
      }
      .text {
	margin-left: auto;
	margin-right: auto;
	width: 100%;
        text-align: left;
      }
    </style>
    <div class="page">
      <h1>Morse Code Output</h1>
      <div class="center">
	<h2>Text to Output</h2>
	<form>
	  <input id="text" type="text" size="32" onkeydown="if (event.keyCode == 13) { morse_code_send_text('text'); return false; }"></input>
	  <input type="button" value="Send" onclick="morse_code_send_text('text')"></input>
	</form>
      </div>
      <div class="center">
	<h2>Output Text Decoded</h2>
	<div id="output_text" class="center"></div>
	<button onclick="document.getElementById('output_text').innerHTML = ''">Clear Output</button>
      </div>
      <div class="center">
	<h2>Parameters</h2>
	<div id="output_pitch"></div>
	<div id="output_gain"></div>
	<div id="output_speed"></div>
	<div id="output_rise_time"></div>
	<div id="output_fall_time"></div>
      </div>
      <div class="text">
	<p>
	  The <b>pitch</b> refers to the frequency of the tone
	  measuered in Hertz.
	</p><p>
	  The <b>gain</b> is the volume level of the tone produced
	  measured in decibels below the maximum.
	</p><p>
	  The <b>speed</b> is given in units of words per minute (WPM).  A
	  average word is taken as 50 (or 60) dits in length in the
	  easier (or more difficult) formulation.  Thus 15 WPM comes
	  to 750 dits per minute, 12.5 dits per second, or about 80
	  milliseconds per dit.
	</p><p>
	  The <b>rise</b> and <b>fall</b> define the steepness of the
	  keying envelope in milliseconds.  
	</p><p>
	  The plan for this page was that the <b>Output Text
	  Decoded</b> would display text as it was sounded.  But I
	  will need to insert some sort of governor to prevent the
	  audio generation from running so far ahead of what is being
	  played.
	</p>
      </div>
    </div>
  </body>
</html>
