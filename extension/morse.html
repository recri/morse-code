<!DOCTYPE html>
<html>
  <head>
    <title>Morse Code Library</title>
  </head>
  <body onload="onLoadHandler()">
    <script type="text/javascript" src="morse.js"></script>
    <script type="text/javascript">
      if (!String.prototype.endsWith) {
	String.prototype.endsWith = function(searchString, position) {
		var subjectString = this.toString();
		if (position === undefined || position > subjectString.length) {
			position = subjectString.length;
		}
		position -= searchString.length;
		var lastIndex = subjectString.indexOf(searchString, position);
		return lastIndex !== -1 && lastIndex === position;
	};
      }
    </script>
    <script type="text/javascript">
      var station = morse_code_station();
      station.input_decoder.setLetterConsumer(function(ltr, code) {
        var elt = document.getElementById("inputtext");
        elt.textContent += ltr;
        elt.scrollTop = 1000;
      });
      station.output_decoder.setLetterConsumer(function(ltr, code) {
        var elt = document.getElementById("outputtext");
        elt.textContent += ltr;
        elt.scrollTop = 1000;
      });
      function slider(name, min, max, value, target) {
        // console.log("slider("+name+")");
        var inputname = name+"_input";
        var valuename = name+"_value";
	document.getElementById(name).innerHTML = '<input id="'+inputname+'"/><br/><span id="'+valuename+'"/>';
        var inp = document.getElementById(inputname);
	var val = document.getElementById(valuename);
        inp.type = "range";
	inp.min = min;
	inp.max = max;
	if (name.endsWith('pitch')) {
          inp.onchange = function() {
	    val.innerHTML = ""+inp.value+" Hz";
            target(inp.value)
	  }
	} else if (name.endsWith('speed')) {
          inp.onchange = function() {
	    val.innerHTML = ""+inp.value+" WPM";
            target(inp.value)
	  }
	} else if (name.endsWith('gain')) {
	  inp.onchange = function() {
	    val.innerHTML = ""+inp.value+" dB";
            target(Math.pow(10, inp.value/20));
          }
        } else if (name.endsWith('time')) {
	  inp.onchange = function() {
	    val.innerHTML = ""+inp.value+" sec";
            target(inp.val);
          }
        } else if (name.endsWith('dit')) {
	  inp.onchange = function() {
	    val.innerHTML = ""+inp.value+" dit";
            target(inp.val);
          }
        } else {
	  console.log("unknown slider name: "+name);
          return;
        }
        inp.oninput = inp.onchange;
	inp.value = value;
        inp.onchange();
      };
      function onLoadHandler() {
	slider("straight_pitch", "220", "1760", "550", station.input.straight.setPitch);
	slider("straight_gain", "-40", "0", "-24", station.input.straight.setGain);
	slider("output_pitch", "220", "1760", "600", station.output.setPitch);
	slider("output_speed", "5", "30", "15", station.output.setWPM);
	slider("output_gain", "-40", "0", "-24", station.output.setGain);
	slider("iambic_pitch", "220", "1760", "650", station.input.iambic.setPitch);
	slider("iambic_speed", "5", "30", "15", station.input.iambic.setWPM);
	slider("iambic_gain", "-40", "0", "-24", station.input.iambic.setGain);
      };
    </script>
    <style>
      .page {
	margin-left: auto;
	margin-right: auto;
        text-align: center;
	width: 50%;
      }
      .center {
	margin-left: auto;
	margin-right: auto;
	width: 100%;
        text-align: center;
      }
      .right {
	float: right;
	width: 50%;
        text-align: center;
      }
      .left {
	float: left;
	width: 50%;
        text-align: center;
      }
      #inputtext, #outputtext {
	height:120px;
	width:100%;
	border:1px solid #ccc;
	font:16px/26px Georgia, Garamond, Serif;
	overflow:auto;
      }
      .column-left { float: left; width: 33%; }
      .column-right { float: right; width: 33%; }
      .column-center { display: inline-block; width: 33%; }
    </style>
    <div class="page">
      <div class="center">
	<h1>Morse Code Demo</h1>
	<div class="left">
	  <h2>Straight Key</h2>
	  <input id="straight" type="image" src="straight2.jpg" width="160px" height="120px" alt="straight key"
		 onkeydown="station.input.straight.onKeydown(event)" onkeyup="station.input.straight.onKeyup(event)"
	         onfocus="station.input.straight.onFocus()" onblur="station.input.straight.onBlur()"></input>
	</div>
	<div class="right">
	  <h2>Iambic Key</h2>
	  <input id="iambic" type="image" src="paddle1.jpg" width="160px" height="120px" alt="iambic key"
		 onkeydown="station.input.iambic.onKeydown(event)" onkeyup="station.input.iambic.onKeyup(event)"
	         onfocus="station.input.iambic.onFocus()" onblur="station.input.iambic.onBlur()"></input>
	</div>
      </div>
      <div class="center">
	<h2>Input Text</h2>
	<div id="inputtext" class="center"></div>
      </div>
      <div class="center">
	<h2>Output Text</h2>
	<div id="outputtext" class="center"></div>
      </div>
      <div class="center">
	<h2>Parameters</h2>
	<div class="column-left">
	  <h3>Straight Key</h3>
	  <div id="straight_pitch"></div>
	  <div id="straight_gain"></div>
	</div>
	<div class="column-center">
	  <h3>Output</h3>
	  <div id="output_pitch"></div>
	  <div id="output_speed"></div>
	  <div id="output_gain"></div>
	</div>
	<div class="column-right">
	  <h3>Iambic Key</h3>
	  <div id="iambic_pitch"></div>
	  <div id="iambic_speed"></div>
	  <div id="iambic_gain"></div>
	</div>
      </div>
    </div>
  </input>
  </body>
</html>


